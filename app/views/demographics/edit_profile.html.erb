<!-- ========================= Edit Profile Page Starts ========================= -->

<%= content_for(:left_menu) do %>

        <%= render :partial=>"dashboards/left_menu" %>


<% end %>


<%= content_for(:dialogue_bar_header) do %>
    Your profile
<% end %>

<%= content_for(:page_header) do %>
    Edit Profile
<% end %>


<section id="edit_profile_section">
  <!--<div class="container">-->
    <div class="row" style="padding-top: 3%;">
      <div class="col-xs-9 col-sm-9 col-md-9 col-lg-9">



        <%#= form_for @user, :url => { :controller => "users/registrations", :action => "update_profile" }, :html => { :method => :post,:class => "form-horizontal" } do |f| %>
        <%#= form_for(:user, :url => registration_path(@user), :html => { :method => :put,:class => "form-horizontal" }) do |f| %>
        <%= form_for @user, :url => { :controller => "users/registrations", :action => "update" }, :html => { :method => :post,:class => "form-horizontal" } do |f| %>



            <%= f.fields_for :demographic do |d| %>
                <div class="form-group">
                  <div class="col-sm-8 col-lg-8">

                    <%= d.text_field :name,:value=>@user.demographic.name, :placeholder=>"Name", :class=>"form-control" %>
                  </div>
                </div>

              <div class="form-group">
                <div class="col-sm-8 col-lg-8">
                  <%= d.text_field :nickname, :value=>@user.demographic.nickname, :placeholder=>"Nickname", :class=>"form-control" %>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-8 col-lg-8">
                  <%= d.label :avatar %>

                  <%= d.file_field :avatar,:class=>"form-control12" %>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-8 col-lg-8">
                  <%= f.password_field :current_password, :placeholder=>"Current Password", :class=>"form-control" %>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-8 col-lg-8">
                  <%= f.password_field :password, :autocomplete => "off", :placeholder=>"New Password", :class=>"form-control" %>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-8 col-lg-8">
                  <%= f.password_field :password_confirmation, :placeholder=>"Confirm New Password", :class=>"form-control" %>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-8 col-lg-8">
                  <h6 class="white">Date of Birth</h6>
                  <%= d.date_select :dob, { :order => [:day, :month, :year], :start_year => (Time.now.year-64), :end_year => (Time.now.year-18),:selected=>@user.demographic.dob}, {:class => "lhc_chosen"} %>
                </div>
              </div>

                <div class="form-group">
                  <div class="col-sm-3 col-lg-2">
                    <h6 class="white">Gender</h6>
                    <%= d.radio_button :male,true, {:checked=>@user.demographic.male, :class=>"my_gender lhc-radio-btn"} %>
                    <label for="user_demographic_attributes_male_true" class="custom-radio-btn male-radio-btn my_gender" id="user_male_lable"></label>
                    <%= d.radio_button :male,false,{:checked=>!@user.demographic.male, :class=>"my_gender lhc-radio-btn"} %>
                    <label for="user_demographic_attributes_male_false" class="custom-radio-btn female-radio-btn my_gender" id="user_female_lable"></label>
                </div>
                  <div class="col-sm-4 col-lg-3">
                    <h6 class="white">Smoking</h6>
                    <%= d.select :smoking, ['Never','Socially','Often'], {:selected => @user.demographic.smoking }, { :class => 'lhc_chosen' } %>
                  </div>
                  <div class="col-sm-4 col-lg-3">
                    <h6 class="white">Drinking</h6>
                    <%= d.select :drinking, ['Never','Socially','Often'], {:selected => @user.demographic.drinking }, { :class => 'lhc_chosen' } %>
                  </div>

              </div>






              <div class="form-group">

                <div class="col-sm-4 col-lg-8">

                  <%= d.text_field :location, :value=>@user.demographic.location,:placeholder=>"Type in the location...", :class=>"form-control location" %>
                </div>

              </div>


              <div class="form-group">
                <div class="col-sm-8 col-lg-8">
                  <%= d.text_field :religion, :placeholder=>"Religion",:value => @user.demographic.religion, :class=>"form-control" %>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-4 col-lg-4">
                  <%= f.fields_for :attendances do |a| %>
                          <%= a.collection_select(:institution_id, Institution.all, :id, :name,{}, {:class=>"lhc_chosen"}) %>
                  <% end %>
                </div>

                <div class="col-sm-4 col-lg-4">
                  <%= f.fields_for :profession do |p| %>
                      <%= p.text_field :name , :placeholder=>"Professions",:class=>"form-control" %>
                  <% end %>
                </div>
              </div>

              <h4>About Myself</h4><hr>

              <div class="form-group">
                <div class="col-sm-8 col-lg-8">
                  <%= d.text_area :description , :placeholder=>"Description",:class=>"form-control" %>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-8 col-lg-8">
                  <%= d.text_area :goal , :placeholder=>"In next 5 years, I would be",:class=>"form-control" %>
                </div>
              </div>

      <% end %>


          <h4>Looking For</h4><hr>
            <%= f.fields_for :criterion do |c| %>


                <div class="form-group">
                  <div class="col-sm-3 col-lg-3">
                    <h6 class="white">Gender</h6>
                    <%= c.radio_button :male,true, {:checked=>@user.demographic.male, :class=>"my_gender lhc-radio-btn"} %>
                    <label for="user_criterion_attributes_male_true" class="custom-radio-btn male-radio-btn my_gender" id="user_male_lable"></label>
                    <%= c.radio_button :male,false,{:checked=>!@user.demographic.male, :class=>"my_gender lhc-radio-btn"} %>
                    <!--<%#= c.label :male,' ',:class=>"custom-radio-btn female-radio-btn my_gender" %>-->
                    <label for="user_criterion_attributes_male_false" class="custom-radio-btn female-radio-btn my_gender" id="user_female_lable"></label>
                  </div>
                </div>

                <div class="form-group">
                    <% min_age = 18..28 %>
                    <% max_age = 22..36 %>
                  <div class="col-sm-4 col-lg-4">
                    <h6 class="white">Age From</h6>
                    <%= c.select(:minage, min_age.collect {|d| [d.to_s,d.to_s]},{:selected => @user.criterion.minage}, {:class=>"lhc_chosen"}) %>
                  </div>

                  <div class="col-sm-4 col-lg-3 col-lg-offset-1">
                    <h6 class="white">Age To</h6>
                    <%= c.select(:maxage, max_age.collect {|d| [d.to_s,d.to_s]},{:selected => @user.criterion.maxage}, {:class=>"lhc_chosen"}) %>
                  </div>
                </div>



              <div class="form-group">
                <div class="col-sm-4 col-lg-4">
                  <h6 class="white">Smoking</h6>
                  <%= c.select :smoking, ['Never','Socially','Often'], {:selected => @user.criterion.smoking }, { :class => 'lhc_chosen' } %>
                </div>
                <div class="col-sm-4 col-lg-3 col-lg-offset-1">
                  <h6 class="white">Drinking</h6>
                  <%= c.select :drinking, ['Never','Socially','Often'], {:selected => @user.criterion.drinking }, { :class => 'lhc_chosen' } %>
                </div>
              </div>

            <% end %>


           <div class="form-group">
             <div class="col-sm-8 col-lg-8">
                 <p class="white">I like </p>
                 <%= f.collection_select(:hobby_list_ids, HobbyList.order('name ASC').all, :id, :name, {:include_blank => false}, {:multiple => true, :class=>"multiple"}) %>
             </div>
           </div>


          <div class="form-group">
             <div class="col-sm-8 col-lg-8">
                 <p class="white">What Friends Say About Me </p>
                 <%= f.collection_select(:about_list_ids, AboutList.order('name ASC').all, :id, :name, {:include_blank => false}, {:multiple => true, :class=>"multiple"}) %>
             </div>
           </div>


          <div class="form-group">
            <div class="col-sm-4 col-lg-4">
              <textarea class="form-control" rows="3" placeholder="Others"></textarea>
            </div>
          </div>

          <div class="form-group">
            <div class="col-sm-8 col-lg-8">
              <div class="ui-widget">
                <h6 class="white">Search Movie</h6>
                <input id="movie_search_textfield" class="form-control">
              </div>
            </div>
          </div>

          <div class="form-group">
            <div class="col-sm-8 col-lg-8">
              <div class="ui-widget">
                <h6 class="white">Search Music</h6>
                <input id="music_search_textfield" class="form-control">
              </div>
            </div>
          </div>

          <div class="form-group">
            <div class="col-sm-8 col-lg-8">
              <div class="ui-widget">
                <h6 class="white">Search Book</h6>
                <input id="books_search_textfield" class="form-control">
              </div>
            </div>
          </div>

          <div class="form-group row">
            <div class="col-sm-8 col-lg-8" id="user_books_wrapper">
            </div>
          </div>


          <!--<div class="form-group">-->
            <!--<div class="col-sm-8 col-lg-8">-->
              <!--<div class="ui-widget">-->
                <!--<label for="books_suggest_tags">Search Books: </label>-->
                <!--<input id="books_search_tagit_textfield" class="form-control">-->
              <!--</div>-->
            <!--</div>-->
          <!--</div>-->


            <div class="actions">
              <%= f.submit :class=>"btn-main ans_btn" %>
            </div>




    <% end  %>



      </div>
    </div>
</section>


<script>
    var moviesJSON = [];
    var moviesNameTags = [];

    var musicJSON = [];
    var musicNameTags = [];

    var booksJSON = [];
    var booksNameTags = [];
    var added_book_item_counter = 0;

  $(function(){
      var addressPicker = new AddressPicker();
      $('.location').typeahead(null, {
          displayKey: 'description',
          source: addressPicker.ttAdapter()
      });
//      this is bad js... written by rushabh
//      TODO: rmeove this...
      $(".twitter-typeahead").css({"width":"100%"});

      $('.lhc_chosen').chosen();
      $('.chosen-container-single').css('width','158px');

      $(".multiple").multiselect().multiselectfilter();


      $("#movie_search_textfield").autocomplete({
          source: moviesNameTags
      });

      $("#music_search_textfield").autocomplete({
          source: musicNameTags
      });

      $("#books_search_textfield").autocomplete({
          source: booksNameTags,
          select: AutoCompleteSelectHandler
      });

      //$('#books_search_tagit_textfield').tagit();

      var booksavailableTags = ["c", "java"];
      var mt = booksavailableTags;

      $('#books_search_tagit_textfield').on('keyup', function (e) {

          $('#books_search_tagit_textfield').tagit({

              itemName: 'question',
              fieldName: 'tags',
              removeConfirmation: true,
              //availableTags: ["c++", "java", "php", "javascript", "ruby", "python", "c"]
              allowSpaces: true,
              // tagSource: ['foo', 'bar']
              tagSource: function () {
                  var this_text = $('#books_search_tagit_textfield').val();
                  $.ajax({
                      url: "/search_book_db",
                      dataType: "json",
                      data: {
                          //term: 'ruby'
                          book_search_text: this_text
                      },
                      success: function (data) {
                          console.log(data);
                          return data;
                      }

                  });
              },
              autocomplete: {
                  delay: 0,
                  minLength: 2,
                  source: this.tagSource
                  //source: booksavailableTags

              }
          });
      });


      $('#movie_search_textfield').on('keyup', function (e) {
          var movie_search_text = $(this).val();
          var movie_search_text_len = movie_search_text.length;


          // get key code of current keypress event
          var code = (e.keyCode ? e.keyCode : e.which);

          // do nothing if it's an arrow key
          if (code == 37 || code == 38 || code == 39 || code == 40) {
              return;
          }
          else {
              if ((movie_search_text_len >= 3)) {

                  var data = {movie_search_text: []};
                  data["movie_search_text"].push(movie_search_text);
                  //moviesTags = [];
                  moviesNameTags.splice(0, moviesNameTags.length);
                  moviesJSON.splice(0, moviesJSON.length);

//                  $.ajax({
//                      url: "/search_movies_themoviedb",
//                      type: "post",
//                      async: false,
//                      data: JSON.stringify(data),
//                      contentType: "application/json",
//                      success: function (data) {
//                          var movie_name, movie_poster, movie_release_date, movie_id;
//                          $.each(data, function (i, obj) {
//                              movie_name = obj.title;
//                              moviesNameTags.push(movie_name);
//                              moviesJSON.push({"title":movie_name,"id":movie_id});
//                              //moviesTags = jQuery.unique(moviesTags);
//                          });
//                      }
//                  });

                  $.ajax({
                      url: "/search_movies_by_rovicorp",
                      type: "post",
                      async: false,
                      data: JSON.stringify(data),
                      contentType: "application/json",
                      success: function (data) {
                          var movie_name, movie_poster, movie_release_date, movie_id;
                          console.log(data);
                          $.each(data["autocompleteResponse"]["results"], function (i, obj) {
                              movie_name = obj;
                              moviesNameTags.push(movie_name);
                          })
                      }
                  });


              }
          }
      });

      $('#music_search_textfield').on('keyup', function (e) {
          var music_search_text = $(this).val();
          var music_search_text_len = music_search_text.length;

          // get key code of current keypress event
          var code = (e.keyCode ? e.keyCode : e.which);

          // do nothing if it's an arrow key
          if (code == 37 || code == 38 || code == 39 || code == 40) {
              return;
          }
          else {
              if ((music_search_text_len >= 5)) {

                  var data = {music_search_text: []};
                  data["music_search_text"].push(music_search_text);

                  musicNameTags.splice(0, musicNameTags.length);
                  //musicJSON.splice(0, musicJSON.length);

                  $.ajax({
                      url: "/search_music_db",
                      type: "post",
                      async: false,
                      data: JSON.stringify(data),
                      contentType: "application/json",
                      success: function (data) {
                          var music_name, music_poster, music_release_date, music_id;
                          //console.log("data :- " + data["autocompleteResponse"]["results"]);
                          $.each(data["autocompleteResponse"]["results"], function (i, obj) {
                              music_name = obj;
                              musicNameTags.push(music_name);
                          })
                      }
                  });

              }
          }

      });

      $('#books_search_textfield').on('keyup', function (e) {
          var book_search_text = $(this).val();
          var book_search_text_len = book_search_text.length;


          // get key code of current keypress event
          var code = (e.keyCode ? e.keyCode : e.which);

          // do nothing if it's an arrow key
          if (code == 37 || code == 38 || code == 39 || code == 40) {
              return;
          }
          else {
              if ((book_search_text_len >= 3)) {

                  var data = {book_search_text: []};
                  data["book_search_text"].push(book_search_text);
                  booksNameTags.splice(0, booksNameTags.length);
                  booksJSON.splice(0, booksJSON.length);

                  $.ajax({
                      url: "/search_book_db",
                      type: "post",
                      async: false,
                      data: JSON.stringify(data),
                      contentType: "application/json",
                      success: function (data) {
                          var book_name, book_id, book_poster, movie_release_date;
                          $.each(data, function (i, obj) {
                              book_name = obj.title;
                              booksNameTags.push(book_name);
                              booksJSON.push({"title":book_name, "id":obj.id, "author":obj.author, "image":obj.image});
                              //console.log(booksJSON[i]);
                          })
                      }
                  });


              }
          }

      });

  });

  function AutoCompleteSelectHandler(event, ui) {
      var which_ele = $(this).attr('id');
      if (which_ele == "books_search_textfield") {
          var selected_book = ui.item.value;
          //console.log(selected_book);
          $.each(booksJSON, function(key, value) {
              if ( value.title === selected_book) {
                console.log("added_book_item_counter :- " + added_book_item_counter);
                //console.log(added_book_item_counter%3 => 3);
                if (added_book_item_counter <= 3){
                    $('#user_books_wrapper').append("<div class='col-lg-4 text-center'>" +
                                                        "<div class='row'>" +
                                                            "<div class='col-lg-12'>" +
                                                                "<img style='height: 150px;' src="+value.image+">" +
                                                            "</div>" +
                                                        "</div>" +
                                                        "<div class='row'>" +
                                                            "<div class='col-lg-12'>" +
                                                                "<p style='overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; white-space: nowrap; width: 100%;'>" + selected_book + "</p>" +
                                                                "<p style='overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; white-space: nowrap; width: 100%;'>" + value.author + "</p>" +
                                                            "</div>" +
                                                        "</div>" +
                                                    "</div>");
                }
                else{
                    $('#user_books_wrapper').append("<div class='row' id=book_row_"+added_book_item_counter+">" + "</div>");
                    $("#book_row_"+added_book_item_counter).append("<div class=col-lg-3>" +
                            "<h6>" + selected_book + "</h6>" +
                            "<img src="+value.image+">" +
                            "</div>")
                }


                //$('#user_books_wrapper').append();

                added_book_item_counter = added_book_item_counter + 1;
                console.log(added_book_item_counter);
              }
          });
          this.value = "";
          return false;
      }
  }

</script>

<!-- ========================= Edit Profile Page Ends ========================= -->